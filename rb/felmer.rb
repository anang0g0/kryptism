#! /usr/local/bin/ruby
# /root/ruby-1.6.7/sample/felmer.rb
# Created: May 28,2003 19:19:33
# Author: tcshacina
# $Id: felmer.rb,v 0.9 2003/03/28 19:37:57 tetsu Exp $
# usage: ruby felmer.rb
# hint:  Miller-Rabin primality test


# GCD
def gcd(xx, yy)
  
  while (yy != 0) 
    tt = xx % yy
    xx = yy
    yy = tt
  end

  return xx

end


#jj=aa^bb mod oo
def exp(aa, bb, oo)

  ii=oo
  j=0
  jj=0
  kk=[2**12] #prime is 4096 bit table
  c=[2**13]  #mod is 8192 bit table
  count=0

#  for i in 0..1023
#    kk[i]=0
#  end
  while(ii>0)
	ii = (ii>>1)
	j=j+1
  end

  kk[0]=aa

#ex.1000=2**3+2**5+2**6+2**7+2**8+2**9 makes a array c=[3,5,6,7,8,9]
    for i in 0..j
      if (((bb^(1<<i))>>i)%2 == 0) # testbit(bb,i)
	c[count]=i
	count=count+1
      end
    end
#    print count,"\n"

    for i in 1..(c[count-1]+1)
      kk[i] = kk[i-1]*kk[i-1]%oo
    end

    jj=1
    for i in 0..count-1
      jj=kk[c[i]]*jj%oo
      if (jj==0)
#	print i,"\n"
      end
    end

    return jj
end


def mr(n)
 i=2
 j=1
 s=1
 count=0
 while n>i
  if((n-1)%i==0)
   s=j
#   print i," "
  end
  i=i*2
  j=j+1
 end
 if(s>0)
  d=(n-1)/(2**s)
#  print "d=",d,"\n"
#  print "s=",s,"\n"
 end

 i=Math.sqrt(n)
 for a in 1..i
  f=0
#  a=srand()%n+1
#print "a=",a,"\n"
  if(gcd(a,n)==1)
   if(exp(a,d,n)==1)
    f=1
    # print n," is prime at1\n"
   end
   for r in 0..s-1
    if(exp(a,(2**r)*d,n)==n-1)
     f=1
    # print a," is prime at2\n"
    end
   end
  end
  if(f==0)
#   print a,"is witness of ",n,"\n"
   break
  end
#  count=count+1
#print "count=",count,"\n"
 end
 if(f==1)
  print n," is prime\n"
 end
  if(n%100==0)
   print "\n"
  end

end


def fr(n)
f=0
 for a in 2..100
=begin
  if(gcd(a,n)!=1)
   print n," is not prime at ",a,"\n"
  end
=end

  if(a**(n-1)%n!=1)
   f=1
   print n," is not prime at ",a,"\n"
   break
  end
 end

 if(f==0)
  print n," is prime\n"
 end
end



#fr(101459693097608319042758415833807677670847628544715540724500026735349301068515392099767184641851031376113522183648115338953972239406909609350543459251533166139494901562515248706419170211273185584865994044063658192209029166200554581462882695234974056443041025544008790901161520035530940963382832098363453248929)
#fr(101459693097608319042758415833807677670847628544715540724500026735349301068515392099767184641851031376113522183648115338953972239406909609350543459251533166139494901562515248706419170211273185584865994044063658192209029166200554581462882695234974056443041025679098587842607769880130803257635362098004642676067)
mr(101459693097608319042758415833807677670847628544715540724500026735349301068515392099767184641851031376113522183648115338953972239406909609350543459251533166139494901562515248706419170211273185584865994044063658192209029166200554581462882695234974056443041026219457775608392769258530252434645482096569400384619)
fr(101459693097608319042758415833807677670847628544715540724500026735349301068515392099767184641851031376113522183648115338953972239406909609350543459251533166139494901562515248706419170211273185584865994044063658192209029166200554581462882695234974056443041027399552553487693342613655486269495169449756802276859)
fr(101459693097608319042758415833807677670847628544715540724500026735349301068515392099767184641851031376113522183648115338953972239406909609350543459251533166139494901562515248706419170211273185584865994044063658192209029166200554581462882695234974056443041027450793510948241920140917503001797853242724149990601)
fr(101459693097608319042758415833807677670847628544715540724500026735349301068515392099767184641851031376113522183648115338953972239406909609350543459251533166139494901562515248706419170211273185584865994044063658192209029166200554581462882695234974056443041028084318075915024333205247891692085580137593176269593)
fr(101459693097608319042758415833807677670847628544715540724500026735349301068515392099767184641851031376113522183648115338953972239406909609350543459251533166139494901562515248706419170211273185584865994044063658192209029166200554581462882695234974056443041028130900764515523040048213361448724383585745310554813)
fr(101459693097608319042758415833807677670847628544715540724500026735349301068515392099767184641851031376113522183648115338953972239406909609350543459251533166139494901562515248706419170211273185584865994044063658192209029166200554581462882695234974056443041028633993801400909073952240434820423460825788360835189)
fr(101459693097608319042758415833807677670847628544715540724500026735349301068515392099767184641851031376113522183648115338953972239406909609350543459251533166139494901562515248706419170211273185584865994044063658192209029166200554581462882695234974056443041028708526103161707004900985186431045546342831775691541)

